"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _loaderUtils = require("@loaders.gl/loader-utils");

var _fuzzy = require("fuzzy");

var _react = _interopRequireWildcard(require("react"));

var _icons = require("../common/icons");

var _customPanelStyle = _interopRequireDefault(require("./custom-panel-style.js"));

// Copyright (c) 2021 Uber Technologies, Inc.
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.
// import logopro from './logopro.png';
// This is a dummy component that can be replaced to inject more side panel sub panels into the side bar
function CustomPanelsFactory() {
  var CustomPanels = function CustomPanels(props) {
    var filterTypes = [{
      index: 0,
      columnName: 'Tc1'
    }, {
      index: 1,
      columnName: 'Tc2'
    }, {
      index: 2,
      columnName: 'Tc3'
    }, {
      index: 3,
      columnName: 'Tc4'
    }, {
      index: 4,
      columnName: 'Tc5'
    }, {
      index: 5,
      columnName: 'Tc6'
    }, {
      index: 6,
      columnName: 'disciplines'
    }, {
      index: 7,
      columnName: 'Category'
    }, {
      index: 8,
      columnName: 'yearTS'
    }];
    var TC1 = filterTypes[0],
        TC2 = filterTypes[1],
        TC3 = filterTypes[2],
        TC4 = filterTypes[3],
        TC5 = filterTypes[4],
        TC6 = filterTypes[5],
        DICIPLINES = filterTypes[6],
        CATEGORY = filterTypes[7],
        TIMELINE = filterTypes[8];
    var setFilter = props.setFilter,
        addFilter = props.addFilter,
        removeFilter = props.removeFilter,
        datasets = props.datasets,
        enlargeFilter = props.enlargeFilter,
        layerConfigChange = props.layerConfigChange,
        layers = props.layers;

    var _useState = (0, _react.useState)([]),
        _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
        selectedFilters = _useState2[0],
        setSelectedFilters = _useState2[1];

    var filters = [{
      label: 'Timeline',
      keyword: 'yearTS',
      type: TIMELINE
    }, {
      label: 'TC1',
      keyword: 'y',
      type: TC1
    }, {
      label: 'TC2',
      keyword: 'y',
      type: TC2
    }, {
      label: 'TC3',
      keyword: 'y',
      type: TC3
    }, {
      label: 'TC4',
      keyword: 'y',
      type: TC4
    }, {
      label: 'TC5',
      keyword: 'y',
      type: TC5
    }, {
      label: 'TC6',
      keyword: 'y',
      type: TC6
    }, {
      label: 'Literature',
      keyword: 'Literature',
      type: DICIPLINES
    }, {
      label: 'Music',
      keyword: 'Music',
      type: DICIPLINES
    }, {
      label: 'Visual Arts',
      keyword: 'Visual Arts',
      type: DICIPLINES
    }, {
      label: 'Performing Arts',
      keyword: 'Performing Arts',
      type: DICIPLINES
    }, {
      label: 'Multidisciplinary',
      keyword: 'Multidisciplinary',
      type: DICIPLINES
    }, {
      label: 'Architecture',
      keyword: ' Architecture ',
      type: DICIPLINES
    }, {
      label: '1',
      keyword: 'a',
      type: CATEGORY
    }, {
      label: '2',
      keyword: 'b',
      type: CATEGORY
    }, {
      label: '3',
      keyword: 'c',
      type: CATEGORY
    }, {
      label: '4',
      keyword: 'd',
      type: CATEGORY
    }, {
      label: '5',
      keyword: 'e',
      type: CATEGORY
    }];
    (0, _react.useEffect)(function () {
      // Agrega los filtros al iniciar
      filterTypes.forEach(function () {
        addFilter(Object.keys(datasets)[0]);
      }); // Se inicializa este layer con visible false para los related links

      layerConfigChange(layers[2], {
        isVisible: false
      });
    }, []);
    (0, _react.useEffect)(function () {
      // Agrega los filtros de tipo keyword
      filterTypes.forEach(function (filterType) {
        if (filterType.columnName == TIMELINE.columnName) return;
        var keywords = selectedFilters.filter(function (f) {
          return f.type.columnName == filterType.columnName;
        }).map(function (f) {
          return f.keyword;
        });
        setFilter(filterType.index, 'name', "".concat(filterType.columnName));
        setFilter(filterType.index, 'value', keywords);
      }); // Agrega los filtros de tipo TIMELINE

      selectedFilters.filter(function (f) {
        return f.type.columnName == TIMELINE.columnName;
      }).forEach(function (_ref) {
        var keyword = _ref.keyword;
        setFilter(TIMELINE.index, 'name', keyword);
      });
    }, [selectedFilters]);

    var removeFilters = function removeFilters() {
      setSelectedFilters([]);
      removeFilter(TIMELINE.index);
      addFilter(Object.keys(datasets)[0]);
    };

    var Button = function Button(filter) {
      var keyword = filter.keyword,
          label = filter.label,
          type = filter.type;
      var buttonStyle = selectedFilters.find(function (f) {
        return f.keyword == keyword && f.type.columnName == type.columnName;
      }) ? _customPanelStyle["default"].button.selected : _customPanelStyle["default"].button;

      var action = function action() {
        var filterIndex = selectedFilters.findIndex(function (f) {
          return f.keyword == keyword && f.type.columnName == type.columnName;
        });

        if (filterIndex > -1) {
          var tcFilter = function tcFilter(f) {
            return f.type.columnName !== type.columnName;
          };

          var othersFilter = function othersFilter(f) {
            return f.keyword !== keyword;
          };

          var newFilters = selectedFilters.filter(type.columnName.startsWith('Tc') ? tcFilter : othersFilter);

          if (!newFilters.length) {
            removeFilters();
          } else {
            setSelectedFilters(newFilters);
          }
        } else {
          setSelectedFilters([].concat((0, _toConsumableArray2["default"])(selectedFilters), [filter]));
        }

        if (type.columnName == TIMELINE.columnName) {
          enlargeFilter(TIMELINE.index);
        }
      };

      return /*#__PURE__*/_react["default"].createElement("button", {
        style: buttonStyle,
        key: "".concat(keyword, "_").concat(type.columnName),
        onClick: action
      }, label);
    };

    var ToggleButton = function ToggleButton(_ref2) {
      var label = _ref2.label,
          isSelected = _ref2.isSelected;

      var action = function action() {
        layerConfigChange(layers[2], {
          isVisible: !layers[2].config.isVisible
        });
      };

      var buttonStyle = isSelected ? _customPanelStyle["default"].button.selected : _customPanelStyle["default"].button;
      return /*#__PURE__*/_react["default"].createElement("button", {
        style: buttonStyle,
        onClick: action
      }, label);
    };

    return /*#__PURE__*/_react["default"].createElement("div", {
      style: _customPanelStyle["default"].container
    }, /*#__PURE__*/_react["default"].createElement("p", {
      style: _customPanelStyle["default"].title
    }, "Use the timeline or choose keywords to filter the projects."), filters.map(function (filter) {
      return Button(filter);
    }), /*#__PURE__*/_react["default"].createElement(ToggleButton, {
      label: "Related links",
      isSelected: layers[2].config.isVisible
    }), /*#__PURE__*/_react["default"].createElement("button", {
      style: _customPanelStyle["default"].removeButton,
      onClick: removeFilters
    }, " Remove filters "), /*#__PURE__*/_react["default"].createElement("img", {
      style: _customPanelStyle["default"].logo,
      width: "160",
      height: "25",
      alt: "logo",
      src: 'https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F4%2F41%2FProhelvetia_Logo.svg%2F1134px-Prohelvetia_Logo.svg.png&f=1&nofb=1'
    }));
  };

  CustomPanels.defaultProps = {
    // provide a list of additional panels
    panels: [{
      id: 'predefined-filters',
      label: 'Filters',
      iconComponent: _icons.FilterFunnel
    } // {
    //   id: 'chart',
    //   label: 'Chart',
    //   iconComponent: Icons.LineChart
    // }
    ],
    // prop selector from side panel props
    getProps: function getProps(sidePanelProps) {
      return {};
    }
  };
  return CustomPanels;
}

var _default = CustomPanelsFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3NpZGUtcGFuZWwvY3VzdG9tLXBhbmVsLmpzIl0sIm5hbWVzIjpbIkN1c3RvbVBhbmVsc0ZhY3RvcnkiLCJDdXN0b21QYW5lbHMiLCJwcm9wcyIsImZpbHRlclR5cGVzIiwiaW5kZXgiLCJjb2x1bW5OYW1lIiwiVEMxIiwiVEMyIiwiVEMzIiwiVEM0IiwiVEM1IiwiVEM2IiwiRElDSVBMSU5FUyIsIkNBVEVHT1JZIiwiVElNRUxJTkUiLCJzZXRGaWx0ZXIiLCJhZGRGaWx0ZXIiLCJyZW1vdmVGaWx0ZXIiLCJkYXRhc2V0cyIsImVubGFyZ2VGaWx0ZXIiLCJsYXllckNvbmZpZ0NoYW5nZSIsImxheWVycyIsInNlbGVjdGVkRmlsdGVycyIsInNldFNlbGVjdGVkRmlsdGVycyIsImZpbHRlcnMiLCJsYWJlbCIsImtleXdvcmQiLCJ0eXBlIiwiZm9yRWFjaCIsIk9iamVjdCIsImtleXMiLCJpc1Zpc2libGUiLCJmaWx0ZXJUeXBlIiwia2V5d29yZHMiLCJmaWx0ZXIiLCJmIiwibWFwIiwicmVtb3ZlRmlsdGVycyIsIkJ1dHRvbiIsImJ1dHRvblN0eWxlIiwiZmluZCIsInN0eWxlIiwiYnV0dG9uIiwic2VsZWN0ZWQiLCJhY3Rpb24iLCJmaWx0ZXJJbmRleCIsImZpbmRJbmRleCIsInRjRmlsdGVyIiwib3RoZXJzRmlsdGVyIiwibmV3RmlsdGVycyIsInN0YXJ0c1dpdGgiLCJsZW5ndGgiLCJUb2dnbGVCdXR0b24iLCJpc1NlbGVjdGVkIiwiY29uZmlnIiwiY29udGFpbmVyIiwidGl0bGUiLCJyZW1vdmVCdXR0b24iLCJsb2dvIiwiZGVmYXVsdFByb3BzIiwicGFuZWxzIiwiaWQiLCJpY29uQ29tcG9uZW50IiwiRmlsdGVyRnVubmVsIiwiZ2V0UHJvcHMiLCJzaWRlUGFuZWxQcm9wcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQXhCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU9BO0FBRUE7QUFDQSxTQUFTQSxtQkFBVCxHQUErQjtBQUM3QixNQUFNQyxZQUFZLEdBQUcsU0FBZkEsWUFBZSxDQUFBQyxLQUFLLEVBQUk7QUFDNUIsUUFBTUMsV0FBVyxHQUFHLENBQ2xCO0FBQUVDLE1BQUFBLEtBQUssRUFBRSxDQUFUO0FBQVlDLE1BQUFBLFVBQVUsRUFBRTtBQUF4QixLQURrQixFQUVsQjtBQUFFRCxNQUFBQSxLQUFLLEVBQUUsQ0FBVDtBQUFZQyxNQUFBQSxVQUFVLEVBQUU7QUFBeEIsS0FGa0IsRUFHbEI7QUFBRUQsTUFBQUEsS0FBSyxFQUFFLENBQVQ7QUFBWUMsTUFBQUEsVUFBVSxFQUFFO0FBQXhCLEtBSGtCLEVBSWxCO0FBQUVELE1BQUFBLEtBQUssRUFBRSxDQUFUO0FBQVlDLE1BQUFBLFVBQVUsRUFBRTtBQUF4QixLQUprQixFQUtsQjtBQUFFRCxNQUFBQSxLQUFLLEVBQUUsQ0FBVDtBQUFZQyxNQUFBQSxVQUFVLEVBQUU7QUFBeEIsS0FMa0IsRUFNbEI7QUFBRUQsTUFBQUEsS0FBSyxFQUFFLENBQVQ7QUFBWUMsTUFBQUEsVUFBVSxFQUFFO0FBQXhCLEtBTmtCLEVBT2xCO0FBQUVELE1BQUFBLEtBQUssRUFBRSxDQUFUO0FBQVlDLE1BQUFBLFVBQVUsRUFBRTtBQUF4QixLQVBrQixFQVFsQjtBQUFFRCxNQUFBQSxLQUFLLEVBQUUsQ0FBVDtBQUFZQyxNQUFBQSxVQUFVLEVBQUU7QUFBeEIsS0FSa0IsRUFTbEI7QUFBRUQsTUFBQUEsS0FBSyxFQUFFLENBQVQ7QUFBWUMsTUFBQUEsVUFBVSxFQUFFO0FBQXhCLEtBVGtCLENBQXBCO0FBRDRCLFFBWXJCQyxHQVpxQixHQVkyQ0gsV0FaM0M7QUFBQSxRQVloQkksR0FaZ0IsR0FZMkNKLFdBWjNDO0FBQUEsUUFZWEssR0FaVyxHQVkyQ0wsV0FaM0M7QUFBQSxRQVlOTSxHQVpNLEdBWTJDTixXQVozQztBQUFBLFFBWURPLEdBWkMsR0FZMkNQLFdBWjNDO0FBQUEsUUFZSVEsR0FaSixHQVkyQ1IsV0FaM0M7QUFBQSxRQVlTUyxVQVpULEdBWTJDVCxXQVozQztBQUFBLFFBWXFCVSxRQVpyQixHQVkyQ1YsV0FaM0M7QUFBQSxRQVkrQlcsUUFaL0IsR0FZMkNYLFdBWjNDO0FBQUEsUUFjcEJZLFNBZG9CLEdBY3VFYixLQWR2RSxDQWNwQmEsU0Fkb0I7QUFBQSxRQWNUQyxTQWRTLEdBY3VFZCxLQWR2RSxDQWNUYyxTQWRTO0FBQUEsUUFjRUMsWUFkRixHQWN1RWYsS0FkdkUsQ0FjRWUsWUFkRjtBQUFBLFFBY2dCQyxRQWRoQixHQWN1RWhCLEtBZHZFLENBY2dCZ0IsUUFkaEI7QUFBQSxRQWMwQkMsYUFkMUIsR0FjdUVqQixLQWR2RSxDQWMwQmlCLGFBZDFCO0FBQUEsUUFjeUNDLGlCQWR6QyxHQWN1RWxCLEtBZHZFLENBY3lDa0IsaUJBZHpDO0FBQUEsUUFjNERDLE1BZDVELEdBY3VFbkIsS0FkdkUsQ0FjNERtQixNQWQ1RDs7QUFBQSxvQkFla0IscUJBQVMsRUFBVCxDQWZsQjtBQUFBO0FBQUEsUUFlckJDLGVBZnFCO0FBQUEsUUFlSkMsa0JBZkk7O0FBaUI1QixRQUFNQyxPQUFPLEdBQUcsQ0FDZDtBQUNFQyxNQUFBQSxLQUFLLEVBQUUsVUFEVDtBQUVFQyxNQUFBQSxPQUFPLEVBQUUsUUFGWDtBQUdFQyxNQUFBQSxJQUFJLEVBQUViO0FBSFIsS0FEYyxFQU1kO0FBQ0VXLE1BQUFBLEtBQUssRUFBRSxLQURUO0FBRUVDLE1BQUFBLE9BQU8sRUFBRSxHQUZYO0FBR0VDLE1BQUFBLElBQUksRUFBRXJCO0FBSFIsS0FOYyxFQVdkO0FBQ0VtQixNQUFBQSxLQUFLLEVBQUUsS0FEVDtBQUVFQyxNQUFBQSxPQUFPLEVBQUUsR0FGWDtBQUdFQyxNQUFBQSxJQUFJLEVBQUVwQjtBQUhSLEtBWGMsRUFnQmQ7QUFDRWtCLE1BQUFBLEtBQUssRUFBRSxLQURUO0FBRUVDLE1BQUFBLE9BQU8sRUFBRSxHQUZYO0FBR0VDLE1BQUFBLElBQUksRUFBRW5CO0FBSFIsS0FoQmMsRUFxQmQ7QUFDRWlCLE1BQUFBLEtBQUssRUFBRSxLQURUO0FBRUVDLE1BQUFBLE9BQU8sRUFBRSxHQUZYO0FBR0VDLE1BQUFBLElBQUksRUFBRWxCO0FBSFIsS0FyQmMsRUEwQmQ7QUFDRWdCLE1BQUFBLEtBQUssRUFBRSxLQURUO0FBRUVDLE1BQUFBLE9BQU8sRUFBRSxHQUZYO0FBR0VDLE1BQUFBLElBQUksRUFBRWpCO0FBSFIsS0ExQmMsRUErQmQ7QUFDRWUsTUFBQUEsS0FBSyxFQUFFLEtBRFQ7QUFFRUMsTUFBQUEsT0FBTyxFQUFFLEdBRlg7QUFHRUMsTUFBQUEsSUFBSSxFQUFFaEI7QUFIUixLQS9CYyxFQW9DZDtBQUNFYyxNQUFBQSxLQUFLLEVBQUUsWUFEVDtBQUVFQyxNQUFBQSxPQUFPLEVBQUUsWUFGWDtBQUdFQyxNQUFBQSxJQUFJLEVBQUVmO0FBSFIsS0FwQ2MsRUF5Q2Q7QUFDRWEsTUFBQUEsS0FBSyxFQUFFLE9BRFQ7QUFFRUMsTUFBQUEsT0FBTyxFQUFFLE9BRlg7QUFHRUMsTUFBQUEsSUFBSSxFQUFFZjtBQUhSLEtBekNjLEVBOENkO0FBQ0VhLE1BQUFBLEtBQUssRUFBRSxhQURUO0FBRUVDLE1BQUFBLE9BQU8sRUFBRSxhQUZYO0FBR0VDLE1BQUFBLElBQUksRUFBRWY7QUFIUixLQTlDYyxFQW1EZDtBQUNFYSxNQUFBQSxLQUFLLEVBQUUsaUJBRFQ7QUFFRUMsTUFBQUEsT0FBTyxFQUFFLGlCQUZYO0FBR0VDLE1BQUFBLElBQUksRUFBRWY7QUFIUixLQW5EYyxFQXdEZDtBQUNFYSxNQUFBQSxLQUFLLEVBQUUsbUJBRFQ7QUFFRUMsTUFBQUEsT0FBTyxFQUFFLG1CQUZYO0FBR0VDLE1BQUFBLElBQUksRUFBRWY7QUFIUixLQXhEYyxFQTZEZDtBQUNFYSxNQUFBQSxLQUFLLEVBQUUsY0FEVDtBQUVFQyxNQUFBQSxPQUFPLEVBQUUsZ0JBRlg7QUFHRUMsTUFBQUEsSUFBSSxFQUFFZjtBQUhSLEtBN0RjLEVBa0VkO0FBQ0VhLE1BQUFBLEtBQUssRUFBRSxHQURUO0FBRUVDLE1BQUFBLE9BQU8sRUFBRSxHQUZYO0FBR0VDLE1BQUFBLElBQUksRUFBRWQ7QUFIUixLQWxFYyxFQXVFZDtBQUNFWSxNQUFBQSxLQUFLLEVBQUUsR0FEVDtBQUVFQyxNQUFBQSxPQUFPLEVBQUUsR0FGWDtBQUdFQyxNQUFBQSxJQUFJLEVBQUVkO0FBSFIsS0F2RWMsRUE0RWQ7QUFDRVksTUFBQUEsS0FBSyxFQUFFLEdBRFQ7QUFFRUMsTUFBQUEsT0FBTyxFQUFFLEdBRlg7QUFHRUMsTUFBQUEsSUFBSSxFQUFFZDtBQUhSLEtBNUVjLEVBaUZkO0FBQ0VZLE1BQUFBLEtBQUssRUFBRSxHQURUO0FBRUVDLE1BQUFBLE9BQU8sRUFBRSxHQUZYO0FBR0VDLE1BQUFBLElBQUksRUFBRWQ7QUFIUixLQWpGYyxFQXNGZDtBQUNFWSxNQUFBQSxLQUFLLEVBQUUsR0FEVDtBQUVFQyxNQUFBQSxPQUFPLEVBQUUsR0FGWDtBQUdFQyxNQUFBQSxJQUFJLEVBQUVkO0FBSFIsS0F0RmMsQ0FBaEI7QUE2RkEsMEJBQVUsWUFBTTtBQUNkO0FBQ0FWLE1BQUFBLFdBQVcsQ0FBQ3lCLE9BQVosQ0FBcUIsWUFBTTtBQUN6QlosUUFBQUEsU0FBUyxDQUFDYSxNQUFNLENBQUNDLElBQVAsQ0FBWVosUUFBWixFQUFzQixDQUF0QixDQUFELENBQVQ7QUFDRCxPQUZELEVBRmMsQ0FNZDs7QUFDQUUsTUFBQUEsaUJBQWlCLENBQUNDLE1BQU0sQ0FBQyxDQUFELENBQVAsRUFBWTtBQUFFVSxRQUFBQSxTQUFTLEVBQUU7QUFBYixPQUFaLENBQWpCO0FBQ0QsS0FSRCxFQVFHLEVBUkg7QUFVQSwwQkFBVSxZQUFNO0FBQ2Q7QUFFQTVCLE1BQUFBLFdBQVcsQ0FBQ3lCLE9BQVosQ0FBcUIsVUFBQUksVUFBVSxFQUFJO0FBRWpDLFlBQUlBLFVBQVUsQ0FBQzNCLFVBQVgsSUFBeUJTLFFBQVEsQ0FBQ1QsVUFBdEMsRUFDRTtBQUVGLFlBQU00QixRQUFRLEdBQUdYLGVBQWUsQ0FBQ1ksTUFBaEIsQ0FBdUIsVUFBQUMsQ0FBQztBQUFBLGlCQUFJQSxDQUFDLENBQUNSLElBQUYsQ0FBT3RCLFVBQVAsSUFBcUIyQixVQUFVLENBQUMzQixVQUFwQztBQUFBLFNBQXhCLEVBQ2dCK0IsR0FEaEIsQ0FDb0IsVUFBQUQsQ0FBQztBQUFBLGlCQUFJQSxDQUFDLENBQUNULE9BQU47QUFBQSxTQURyQixDQUFqQjtBQUdBWCxRQUFBQSxTQUFTLENBQUNpQixVQUFVLENBQUM1QixLQUFaLEVBQW1CLE1BQW5CLFlBQThCNEIsVUFBVSxDQUFDM0IsVUFBekMsRUFBVDtBQUNBVSxRQUFBQSxTQUFTLENBQUNpQixVQUFVLENBQUM1QixLQUFaLEVBQW1CLE9BQW5CLEVBQTRCNkIsUUFBNUIsQ0FBVDtBQUNELE9BVkQsRUFIYyxDQWVkOztBQUNBWCxNQUFBQSxlQUFlLENBQ1pZLE1BREgsQ0FDVSxVQUFBQyxDQUFDO0FBQUEsZUFBSUEsQ0FBQyxDQUFDUixJQUFGLENBQU90QixVQUFQLElBQXFCUyxRQUFRLENBQUNULFVBQWxDO0FBQUEsT0FEWCxFQUVHdUIsT0FGSCxDQUVXLGdCQUFpQjtBQUFBLFlBQWRGLE9BQWMsUUFBZEEsT0FBYztBQUN4QlgsUUFBQUEsU0FBUyxDQUFDRCxRQUFRLENBQUNWLEtBQVYsRUFBaUIsTUFBakIsRUFBeUJzQixPQUF6QixDQUFUO0FBQ0QsT0FKSDtBQUtELEtBckJELEVBcUJHLENBQUNKLGVBQUQsQ0FyQkg7O0FBdUJBLFFBQU1lLGFBQWEsR0FBRyxTQUFoQkEsYUFBZ0IsR0FBTTtBQUMxQmQsTUFBQUEsa0JBQWtCLENBQUMsRUFBRCxDQUFsQjtBQUNBTixNQUFBQSxZQUFZLENBQUNILFFBQVEsQ0FBQ1YsS0FBVixDQUFaO0FBQ0FZLE1BQUFBLFNBQVMsQ0FBQ2EsTUFBTSxDQUFDQyxJQUFQLENBQVlaLFFBQVosRUFBc0IsQ0FBdEIsQ0FBRCxDQUFUO0FBQ0QsS0FKRDs7QUFNQSxRQUFNb0IsTUFBTSxHQUFHLFNBQVRBLE1BQVMsQ0FBQUosTUFBTSxFQUFJO0FBQUEsVUFDZlIsT0FEZSxHQUNVUSxNQURWLENBQ2ZSLE9BRGU7QUFBQSxVQUNORCxLQURNLEdBQ1VTLE1BRFYsQ0FDTlQsS0FETTtBQUFBLFVBQ0NFLElBREQsR0FDVU8sTUFEVixDQUNDUCxJQUREO0FBRXZCLFVBQU1ZLFdBQVcsR0FBR2pCLGVBQWUsQ0FBQ2tCLElBQWhCLENBQXFCLFVBQUFMLENBQUM7QUFBQSxlQUFJQSxDQUFDLENBQUNULE9BQUYsSUFBYUEsT0FBYixJQUF3QlMsQ0FBQyxDQUFDUixJQUFGLENBQU90QixVQUFQLElBQXFCc0IsSUFBSSxDQUFDdEIsVUFBdEQ7QUFBQSxPQUF0QixJQUNoQm9DLDZCQUFNQyxNQUFOLENBQWFDLFFBREcsR0FFaEJGLDZCQUFNQyxNQUZWOztBQUlBLFVBQU1FLE1BQU0sR0FBRyxTQUFUQSxNQUFTLEdBQU07QUFDbkIsWUFBTUMsV0FBVyxHQUFHdkIsZUFBZSxDQUFDd0IsU0FBaEIsQ0FBMEIsVUFBQVgsQ0FBQztBQUFBLGlCQUFJQSxDQUFDLENBQUNULE9BQUYsSUFBYUEsT0FBYixJQUF3QlMsQ0FBQyxDQUFDUixJQUFGLENBQU90QixVQUFQLElBQXFCc0IsSUFBSSxDQUFDdEIsVUFBdEQ7QUFBQSxTQUEzQixDQUFwQjs7QUFFQSxZQUFJd0MsV0FBVyxHQUFHLENBQUMsQ0FBbkIsRUFBc0I7QUFFcEIsY0FBTUUsUUFBUSxHQUFHLFNBQVhBLFFBQVcsQ0FBQVosQ0FBQyxFQUFJO0FBQ3BCLG1CQUFPQSxDQUFDLENBQUNSLElBQUYsQ0FBT3RCLFVBQVAsS0FBc0JzQixJQUFJLENBQUN0QixVQUFsQztBQUNELFdBRkQ7O0FBSUEsY0FBTTJDLFlBQVksR0FBRyxTQUFmQSxZQUFlLENBQUFiLENBQUMsRUFBSTtBQUN4QixtQkFBT0EsQ0FBQyxDQUFDVCxPQUFGLEtBQWNBLE9BQXJCO0FBQ0QsV0FGRDs7QUFJQSxjQUFNdUIsVUFBVSxHQUFHM0IsZUFBZSxDQUFDWSxNQUFoQixDQUF3QlAsSUFBSSxDQUFDdEIsVUFBTCxDQUFnQjZDLFVBQWhCLENBQTJCLElBQTNCLElBQW1DSCxRQUFuQyxHQUE4Q0MsWUFBdEUsQ0FBbkI7O0FBRUEsY0FBSSxDQUFDQyxVQUFVLENBQUNFLE1BQWhCLEVBQXdCO0FBQ3RCZCxZQUFBQSxhQUFhO0FBQ2QsV0FGRCxNQUVPO0FBQ0xkLFlBQUFBLGtCQUFrQixDQUFDMEIsVUFBRCxDQUFsQjtBQUNEO0FBQ0YsU0FqQkQsTUFpQk87QUFDTDFCLFVBQUFBLGtCQUFrQiwrQ0FBS0QsZUFBTCxJQUFzQlksTUFBdEIsR0FBbEI7QUFDRDs7QUFFRCxZQUFJUCxJQUFJLENBQUN0QixVQUFMLElBQW1CUyxRQUFRLENBQUNULFVBQWhDLEVBQTRDO0FBQzFDYyxVQUFBQSxhQUFhLENBQUNMLFFBQVEsQ0FBQ1YsS0FBVixDQUFiO0FBQ0Q7QUFDRixPQTNCRDs7QUE2QkEsMEJBQ0U7QUFBUSxRQUFBLEtBQUssRUFBRW1DLFdBQWY7QUFBNEIsUUFBQSxHQUFHLFlBQUtiLE9BQUwsY0FBZ0JDLElBQUksQ0FBQ3RCLFVBQXJCLENBQS9CO0FBQWtFLFFBQUEsT0FBTyxFQUFFdUM7QUFBM0UsU0FDR25CLEtBREgsQ0FERjtBQUtELEtBeENEOztBQTBDQSxRQUFNMkIsWUFBWSxHQUFHLFNBQWZBLFlBQWUsUUFBeUI7QUFBQSxVQUF2QjNCLEtBQXVCLFNBQXZCQSxLQUF1QjtBQUFBLFVBQWhCNEIsVUFBZ0IsU0FBaEJBLFVBQWdCOztBQUU1QyxVQUFNVCxNQUFNLEdBQUcsU0FBVEEsTUFBUyxHQUFNO0FBQ25CeEIsUUFBQUEsaUJBQWlCLENBQUNDLE1BQU0sQ0FBQyxDQUFELENBQVAsRUFBWTtBQUFFVSxVQUFBQSxTQUFTLEVBQUUsQ0FBQ1YsTUFBTSxDQUFDLENBQUQsQ0FBTixDQUFVaUMsTUFBVixDQUFpQnZCO0FBQS9CLFNBQVosQ0FBakI7QUFDRCxPQUZEOztBQUlBLFVBQU1RLFdBQVcsR0FBR2MsVUFBVSxHQUFHWiw2QkFBTUMsTUFBTixDQUFhQyxRQUFoQixHQUEyQkYsNkJBQU1DLE1BQS9EO0FBRUEsMEJBQ0U7QUFBUSxRQUFBLEtBQUssRUFBRUgsV0FBZjtBQUE0QixRQUFBLE9BQU8sRUFBRUs7QUFBckMsU0FDR25CLEtBREgsQ0FERjtBQUtELEtBYkQ7O0FBZUEsd0JBQ0U7QUFBSyxNQUFBLEtBQUssRUFBRWdCLDZCQUFNYztBQUFsQixvQkFDRTtBQUFHLE1BQUEsS0FBSyxFQUFFZCw2QkFBTWU7QUFBaEIscUVBREYsRUFFR2hDLE9BQU8sQ0FBQ1ksR0FBUixDQUFZLFVBQUFGLE1BQU07QUFBQSxhQUFJSSxNQUFNLENBQUNKLE1BQUQsQ0FBVjtBQUFBLEtBQWxCLENBRkgsZUFHRSxnQ0FBQyxZQUFEO0FBQWMsTUFBQSxLQUFLLEVBQUUsZUFBckI7QUFBc0MsTUFBQSxVQUFVLEVBQUViLE1BQU0sQ0FBQyxDQUFELENBQU4sQ0FBVWlDLE1BQVYsQ0FBaUJ2QjtBQUFuRSxNQUhGLGVBSUU7QUFBUSxNQUFBLEtBQUssRUFBRVUsNkJBQU1nQixZQUFyQjtBQUFtQyxNQUFBLE9BQU8sRUFBRXBCO0FBQTVDLDBCQUpGLGVBS0U7QUFBSyxNQUFBLEtBQUssRUFBRUksNkJBQU1pQixJQUFsQjtBQUF3QixNQUFBLEtBQUssRUFBQyxLQUE5QjtBQUFvQyxNQUFBLE1BQU0sRUFBQyxJQUEzQztBQUFnRCxNQUFBLEdBQUcsRUFBQyxNQUFwRDtBQUEyRCxNQUFBLEdBQUcsRUFBRTtBQUFoRSxNQUxGLENBREY7QUFTRCxHQXZORDs7QUF5TkF6RCxFQUFBQSxZQUFZLENBQUMwRCxZQUFiLEdBQTRCO0FBQzFCO0FBQ0FDLElBQUFBLE1BQU0sRUFBRSxDQUNOO0FBQ0VDLE1BQUFBLEVBQUUsRUFBRSxvQkFETjtBQUVFcEMsTUFBQUEsS0FBSyxFQUFFLFNBRlQ7QUFHRXFDLE1BQUFBLGFBQWEsRUFBRUM7QUFIakIsS0FETSxDQU1OO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFWTSxLQUZrQjtBQWMxQjtBQUNBQyxJQUFBQSxRQUFRLEVBQUUsa0JBQUFDLGNBQWM7QUFBQSxhQUFLLEVBQUw7QUFBQTtBQWZFLEdBQTVCO0FBa0JBLFNBQU9oRSxZQUFQO0FBQ0Q7O2VBRWNELG1CIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAyMDIxIFViZXIgVGVjaG5vbG9naWVzLCBJbmMuXG4vL1xuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuLy8gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuLy8gaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xuLy8gdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuLy8gY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG4vLyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuLy9cbi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluXG4vLyBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cbi8vXG4vLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4vLyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbi8vIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuLy8gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuLy8gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbi8vIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cbi8vIFRIRSBTT0ZUV0FSRS5cblxuaW1wb3J0IHsgZm9yRWFjaCB9IGZyb20gJ0Bsb2FkZXJzLmdsL2xvYWRlci11dGlscyc7XG5pbXBvcnQgeyBmaWx0ZXIgfSBmcm9tICdmdXp6eSc7XG5pbXBvcnQgUmVhY3QsIHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEZpbHRlckZ1bm5lbCB9IGZyb20gJy4uL2NvbW1vbi9pY29ucyc7XG5pbXBvcnQgc3R5bGUgZnJvbSAnLi9jdXN0b20tcGFuZWwtc3R5bGUuanMnO1xuLy8gaW1wb3J0IGxvZ29wcm8gZnJvbSAnLi9sb2dvcHJvLnBuZyc7XG5cbi8vIFRoaXMgaXMgYSBkdW1teSBjb21wb25lbnQgdGhhdCBjYW4gYmUgcmVwbGFjZWQgdG8gaW5qZWN0IG1vcmUgc2lkZSBwYW5lbCBzdWIgcGFuZWxzIGludG8gdGhlIHNpZGUgYmFyXG5mdW5jdGlvbiBDdXN0b21QYW5lbHNGYWN0b3J5KCkge1xuICBjb25zdCBDdXN0b21QYW5lbHMgPSBwcm9wcyA9PiB7XG4gICAgY29uc3QgZmlsdGVyVHlwZXMgPSBbXG4gICAgICB7IGluZGV4OiAwLCBjb2x1bW5OYW1lOiAnVGMxJ30sIFxuICAgICAgeyBpbmRleDogMSwgY29sdW1uTmFtZTogJ1RjMid9LCBcbiAgICAgIHsgaW5kZXg6IDIsIGNvbHVtbk5hbWU6ICdUYzMnfSwgXG4gICAgICB7IGluZGV4OiAzLCBjb2x1bW5OYW1lOiAnVGM0J30sIFxuICAgICAgeyBpbmRleDogNCwgY29sdW1uTmFtZTogJ1RjNSd9LCBcbiAgICAgIHsgaW5kZXg6IDUsIGNvbHVtbk5hbWU6ICdUYzYnfSwgXG4gICAgICB7IGluZGV4OiA2LCBjb2x1bW5OYW1lOiAnZGlzY2lwbGluZXMnfSwgXG4gICAgICB7IGluZGV4OiA3LCBjb2x1bW5OYW1lOiAnQ2F0ZWdvcnknfSxcbiAgICAgIHsgaW5kZXg6IDgsIGNvbHVtbk5hbWU6ICd5ZWFyVFMnfVxuICAgIF07XG4gICAgY29uc3QgW1RDMSwgVEMyLCBUQzMsIFRDNCwgVEM1LCBUQzYsIERJQ0lQTElORVMsIENBVEVHT1JZLCBUSU1FTElORV0gPSBmaWx0ZXJUeXBlcztcblxuICAgIGNvbnN0IHsgc2V0RmlsdGVyLCBhZGRGaWx0ZXIsIHJlbW92ZUZpbHRlciwgZGF0YXNldHMsIGVubGFyZ2VGaWx0ZXIsIGxheWVyQ29uZmlnQ2hhbmdlLCBsYXllcnMgfSA9IHByb3BzO1xuICAgIGNvbnN0IFtzZWxlY3RlZEZpbHRlcnMsIHNldFNlbGVjdGVkRmlsdGVyc10gPSB1c2VTdGF0ZShbXSk7XG5cbiAgICBjb25zdCBmaWx0ZXJzID0gW1xuICAgICAge1xuICAgICAgICBsYWJlbDogJ1RpbWVsaW5lJyxcbiAgICAgICAga2V5d29yZDogJ3llYXJUUycsXG4gICAgICAgIHR5cGU6IFRJTUVMSU5FXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBsYWJlbDogJ1RDMScsXG4gICAgICAgIGtleXdvcmQ6ICd5JyxcbiAgICAgICAgdHlwZTogVEMxXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBsYWJlbDogJ1RDMicsXG4gICAgICAgIGtleXdvcmQ6ICd5JyxcbiAgICAgICAgdHlwZTogVEMyXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBsYWJlbDogJ1RDMycsXG4gICAgICAgIGtleXdvcmQ6ICd5JyxcbiAgICAgICAgdHlwZTogVEMzXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBsYWJlbDogJ1RDNCcsXG4gICAgICAgIGtleXdvcmQ6ICd5JyxcbiAgICAgICAgdHlwZTogVEM0XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBsYWJlbDogJ1RDNScsXG4gICAgICAgIGtleXdvcmQ6ICd5JyxcbiAgICAgICAgdHlwZTogVEM1XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBsYWJlbDogJ1RDNicsXG4gICAgICAgIGtleXdvcmQ6ICd5JyxcbiAgICAgICAgdHlwZTogVEM2XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBsYWJlbDogJ0xpdGVyYXR1cmUnLFxuICAgICAgICBrZXl3b3JkOiAnTGl0ZXJhdHVyZScsXG4gICAgICAgIHR5cGU6IERJQ0lQTElORVNcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGxhYmVsOiAnTXVzaWMnLFxuICAgICAgICBrZXl3b3JkOiAnTXVzaWMnLFxuICAgICAgICB0eXBlOiBESUNJUExJTkVTXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBsYWJlbDogJ1Zpc3VhbCBBcnRzJyxcbiAgICAgICAga2V5d29yZDogJ1Zpc3VhbCBBcnRzJyxcbiAgICAgICAgdHlwZTogRElDSVBMSU5FU1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbGFiZWw6ICdQZXJmb3JtaW5nIEFydHMnLFxuICAgICAgICBrZXl3b3JkOiAnUGVyZm9ybWluZyBBcnRzJyxcbiAgICAgICAgdHlwZTogRElDSVBMSU5FU1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbGFiZWw6ICdNdWx0aWRpc2NpcGxpbmFyeScsXG4gICAgICAgIGtleXdvcmQ6ICdNdWx0aWRpc2NpcGxpbmFyeScsXG4gICAgICAgIHR5cGU6IERJQ0lQTElORVNcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGxhYmVsOiAnQXJjaGl0ZWN0dXJlJyxcbiAgICAgICAga2V5d29yZDogJyBBcmNoaXRlY3R1cmUgJyxcbiAgICAgICAgdHlwZTogRElDSVBMSU5FU1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbGFiZWw6ICcxJyxcbiAgICAgICAga2V5d29yZDogJ2EnLFxuICAgICAgICB0eXBlOiBDQVRFR09SWVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbGFiZWw6ICcyJyxcbiAgICAgICAga2V5d29yZDogJ2InLFxuICAgICAgICB0eXBlOiBDQVRFR09SWVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbGFiZWw6ICczJyxcbiAgICAgICAga2V5d29yZDogJ2MnLFxuICAgICAgICB0eXBlOiBDQVRFR09SWVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbGFiZWw6ICc0JyxcbiAgICAgICAga2V5d29yZDogJ2QnLFxuICAgICAgICB0eXBlOiBDQVRFR09SWVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbGFiZWw6ICc1JyxcbiAgICAgICAga2V5d29yZDogJ2UnLFxuICAgICAgICB0eXBlOiBDQVRFR09SWVxuICAgICAgfSxcbiAgICBdO1xuXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgIC8vIEFncmVnYSBsb3MgZmlsdHJvcyBhbCBpbmljaWFyXG4gICAgICBmaWx0ZXJUeXBlcy5mb3JFYWNoKCAoKSA9PiB7XG4gICAgICAgIGFkZEZpbHRlcihPYmplY3Qua2V5cyhkYXRhc2V0cylbMF0pXG4gICAgICB9KTtcblxuICAgICAgLy8gU2UgaW5pY2lhbGl6YSBlc3RlIGxheWVyIGNvbiB2aXNpYmxlIGZhbHNlIHBhcmEgbG9zIHJlbGF0ZWQgbGlua3NcbiAgICAgIGxheWVyQ29uZmlnQ2hhbmdlKGxheWVyc1syXSwgeyBpc1Zpc2libGU6IGZhbHNlIH0gKTtcbiAgICB9LCBbXSk7XG5cbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgLy8gQWdyZWdhIGxvcyBmaWx0cm9zIGRlIHRpcG8ga2V5d29yZFxuXG4gICAgICBmaWx0ZXJUeXBlcy5mb3JFYWNoKCBmaWx0ZXJUeXBlID0+IHtcblxuICAgICAgICBpZiAoZmlsdGVyVHlwZS5jb2x1bW5OYW1lID09IFRJTUVMSU5FLmNvbHVtbk5hbWUpIFxuICAgICAgICAgIHJldHVybjsgXG5cbiAgICAgICAgY29uc3Qga2V5d29yZHMgPSBzZWxlY3RlZEZpbHRlcnMuZmlsdGVyKGYgPT4gZi50eXBlLmNvbHVtbk5hbWUgPT0gZmlsdGVyVHlwZS5jb2x1bW5OYW1lKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoZiA9PiBmLmtleXdvcmQpO1xuICAgICAgICBcbiAgICAgICAgc2V0RmlsdGVyKGZpbHRlclR5cGUuaW5kZXgsICduYW1lJywgYCR7ZmlsdGVyVHlwZS5jb2x1bW5OYW1lfWApO1xuICAgICAgICBzZXRGaWx0ZXIoZmlsdGVyVHlwZS5pbmRleCwgJ3ZhbHVlJywga2V5d29yZHMpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEFncmVnYSBsb3MgZmlsdHJvcyBkZSB0aXBvIFRJTUVMSU5FXG4gICAgICBzZWxlY3RlZEZpbHRlcnNcbiAgICAgICAgLmZpbHRlcihmID0+IGYudHlwZS5jb2x1bW5OYW1lID09IFRJTUVMSU5FLmNvbHVtbk5hbWUpXG4gICAgICAgIC5mb3JFYWNoKCh7IGtleXdvcmQgfSkgPT4ge1xuICAgICAgICAgIHNldEZpbHRlcihUSU1FTElORS5pbmRleCwgJ25hbWUnLCBrZXl3b3JkKTtcbiAgICAgICAgfSk7XG4gICAgfSwgW3NlbGVjdGVkRmlsdGVyc10pO1xuXG4gICAgY29uc3QgcmVtb3ZlRmlsdGVycyA9ICgpID0+IHtcbiAgICAgIHNldFNlbGVjdGVkRmlsdGVycyhbXSk7XG4gICAgICByZW1vdmVGaWx0ZXIoVElNRUxJTkUuaW5kZXgpO1xuICAgICAgYWRkRmlsdGVyKE9iamVjdC5rZXlzKGRhdGFzZXRzKVswXSk7XG4gICAgfTtcblxuICAgIGNvbnN0IEJ1dHRvbiA9IGZpbHRlciA9PiB7XG4gICAgICBjb25zdCB7IGtleXdvcmQsIGxhYmVsLCB0eXBlIH0gPSBmaWx0ZXI7XG4gICAgICBjb25zdCBidXR0b25TdHlsZSA9IHNlbGVjdGVkRmlsdGVycy5maW5kKGYgPT4gZi5rZXl3b3JkID09IGtleXdvcmQgJiYgZi50eXBlLmNvbHVtbk5hbWUgPT0gdHlwZS5jb2x1bW5OYW1lKVxuICAgICAgICA/IHN0eWxlLmJ1dHRvbi5zZWxlY3RlZFxuICAgICAgICA6IHN0eWxlLmJ1dHRvbjtcblxuICAgICAgY29uc3QgYWN0aW9uID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBmaWx0ZXJJbmRleCA9IHNlbGVjdGVkRmlsdGVycy5maW5kSW5kZXgoZiA9PiBmLmtleXdvcmQgPT0ga2V5d29yZCAmJiBmLnR5cGUuY29sdW1uTmFtZSA9PSB0eXBlLmNvbHVtbk5hbWUpO1xuXG4gICAgICAgIGlmIChmaWx0ZXJJbmRleCA+IC0xKSB7XG5cbiAgICAgICAgICBjb25zdCB0Y0ZpbHRlciA9IGYgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGYudHlwZS5jb2x1bW5OYW1lICE9PSB0eXBlLmNvbHVtbk5hbWU7XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIGNvbnN0IG90aGVyc0ZpbHRlciA9IGYgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGYua2V5d29yZCAhPT0ga2V5d29yZDtcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgY29uc3QgbmV3RmlsdGVycyA9IHNlbGVjdGVkRmlsdGVycy5maWx0ZXIoIHR5cGUuY29sdW1uTmFtZS5zdGFydHNXaXRoKCdUYycpID8gdGNGaWx0ZXIgOiBvdGhlcnNGaWx0ZXIgKTtcblxuICAgICAgICAgIGlmICghbmV3RmlsdGVycy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJlbW92ZUZpbHRlcnMoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2V0U2VsZWN0ZWRGaWx0ZXJzKG5ld0ZpbHRlcnMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZXRTZWxlY3RlZEZpbHRlcnMoWy4uLnNlbGVjdGVkRmlsdGVycywgZmlsdGVyXSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZS5jb2x1bW5OYW1lID09IFRJTUVMSU5FLmNvbHVtbk5hbWUpIHtcbiAgICAgICAgICBlbmxhcmdlRmlsdGVyKFRJTUVMSU5FLmluZGV4KTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGJ1dHRvbiBzdHlsZT17YnV0dG9uU3R5bGV9IGtleT17YCR7a2V5d29yZH1fJHt0eXBlLmNvbHVtbk5hbWV9YH0gb25DbGljaz17YWN0aW9ufT5cbiAgICAgICAgICB7bGFiZWx9XG4gICAgICAgIDwvYnV0dG9uPlxuICAgICAgKTtcbiAgICB9O1xuXG4gICAgY29uc3QgVG9nZ2xlQnV0dG9uID0gKHtsYWJlbCwgaXNTZWxlY3RlZH0pID0+IHtcblxuICAgICAgY29uc3QgYWN0aW9uID0gKCkgPT4ge1xuICAgICAgICBsYXllckNvbmZpZ0NoYW5nZShsYXllcnNbMl0sIHsgaXNWaXNpYmxlOiAhbGF5ZXJzWzJdLmNvbmZpZy5pc1Zpc2libGUgfSApO1xuICAgICAgfTtcblxuICAgICAgY29uc3QgYnV0dG9uU3R5bGUgPSBpc1NlbGVjdGVkID8gc3R5bGUuYnV0dG9uLnNlbGVjdGVkIDogc3R5bGUuYnV0dG9uO1xuXG4gICAgICByZXR1cm4gKFxuICAgICAgICA8YnV0dG9uIHN0eWxlPXtidXR0b25TdHlsZX0gb25DbGljaz17YWN0aW9ufT5cbiAgICAgICAgICB7bGFiZWx9XG4gICAgICAgIDwvYnV0dG9uPlxuICAgICAgKVxuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IHN0eWxlPXtzdHlsZS5jb250YWluZXJ9PlxuICAgICAgICA8cCBzdHlsZT17c3R5bGUudGl0bGV9PlVzZSB0aGUgdGltZWxpbmUgb3IgY2hvb3NlIGtleXdvcmRzIHRvIGZpbHRlciB0aGUgcHJvamVjdHMuPC9wPlxuICAgICAgICB7ZmlsdGVycy5tYXAoZmlsdGVyID0+IEJ1dHRvbihmaWx0ZXIpKX1cbiAgICAgICAgPFRvZ2dsZUJ1dHRvbiBsYWJlbD17XCJSZWxhdGVkIGxpbmtzXCJ9IGlzU2VsZWN0ZWQ9e2xheWVyc1syXS5jb25maWcuaXNWaXNpYmxlfSAvPlxuICAgICAgICA8YnV0dG9uIHN0eWxlPXtzdHlsZS5yZW1vdmVCdXR0b259IG9uQ2xpY2s9e3JlbW92ZUZpbHRlcnN9PiBSZW1vdmUgZmlsdGVycyA8L2J1dHRvbj5cbiAgICAgICAgPGltZyBzdHlsZT17c3R5bGUubG9nb30gd2lkdGg9XCIxNjBcIiBoZWlnaHQ9XCIyNVwiIGFsdD1cImxvZ29cIiBzcmM9eydodHRwczovL2V4dGVybmFsLWNvbnRlbnQuZHVja2R1Y2tnby5jb20vaXUvP3U9aHR0cHMlM0ElMkYlMkZ1cGxvYWQud2lraW1lZGlhLm9yZyUyRndpa2lwZWRpYSUyRmNvbW1vbnMlMkZ0aHVtYiUyRjQlMkY0MSUyRlByb2hlbHZldGlhX0xvZ28uc3ZnJTJGMTEzNHB4LVByb2hlbHZldGlhX0xvZ28uc3ZnLnBuZyZmPTEmbm9mYj0xJ30gLz5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH07XG5cbiAgQ3VzdG9tUGFuZWxzLmRlZmF1bHRQcm9wcyA9IHtcbiAgICAvLyBwcm92aWRlIGEgbGlzdCBvZiBhZGRpdGlvbmFsIHBhbmVsc1xuICAgIHBhbmVsczogW1xuICAgICAge1xuICAgICAgICBpZDogJ3ByZWRlZmluZWQtZmlsdGVycycsXG4gICAgICAgIGxhYmVsOiAnRmlsdGVycycsXG4gICAgICAgIGljb25Db21wb25lbnQ6IEZpbHRlckZ1bm5lbFxuICAgICAgfVxuICAgICAgLy8ge1xuICAgICAgLy8gICBpZDogJ2NoYXJ0JyxcbiAgICAgIC8vICAgbGFiZWw6ICdDaGFydCcsXG4gICAgICAvLyAgIGljb25Db21wb25lbnQ6IEljb25zLkxpbmVDaGFydFxuICAgICAgLy8gfVxuICAgIF0sXG4gICAgLy8gcHJvcCBzZWxlY3RvciBmcm9tIHNpZGUgcGFuZWwgcHJvcHNcbiAgICBnZXRQcm9wczogc2lkZVBhbmVsUHJvcHMgPT4gKHt9KVxuICB9O1xuXG4gIHJldHVybiBDdXN0b21QYW5lbHM7XG59XG5cbmV4cG9ydCBkZWZhdWx0IEN1c3RvbVBhbmVsc0ZhY3Rvcnk7XG4iXX0=